{
    "rules": {
        "users": {
            ".read": "auth.token.admin === true",
            "$uid": {
                ".read": "$uid === auth.uid || auth.token.admin === true",
                ".write": "$uid === auth.uid || auth.token.admin === true",
                "email": {
                    ".validate": "newData.isString() && newData.val().length <= 255"
                },
                "username": {
                    ".validate": "newData.isString() && newData.val().length <= 100"
                },
                "createdAt": {
                    ".validate": "newData.isString()"
                },
                "verifiedAt": {
                    ".validate": "newData.isString()"
                },
                "pendingPoints": {
                    ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 10000"
                },
                "availablePoints": {
                    ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 10000"
                },
                "pointsHistory": {
                    "$historyId": {
                        ".validate": "newData.hasChildren(['type', 'points', 'timestamp'])",
                        "type": {
                            ".validate": "newData.isString()"
                        },
                        "points": {
                            ".validate": "newData.isNumber()"
                        },
                        "orderId": {
                            ".validate": "newData.isString()"
                        },
                        "timestamp": {
                            ".validate": "newData.isString()"
                        },
                        "description": {
                            ".validate": "newData.isString()"
                        }
                    }
                },
                "coupons": {
                    "$couponId": {
                        ".validate": "newData.hasChildren(['type', 'value', 'pointsCost', 'createdAt'])",
                        "type": {
                            ".validate": "newData.isString() && (newData.val() === 'percentage' || newData.val() === 'fixed')"
                        },
                        "value": {
                            ".validate": "newData.isNumber() && newData.val() > 0"
                        },
                        "pointsCost": {
                            ".validate": "newData.isNumber() && newData.val() > 0"
                        },
                        "used": {
                            ".validate": "newData.isBoolean()"
                        },
                        "usedAt": {
                            ".validate": "newData.isString()"
                        },
                        "usedInOrder": {
                            ".validate": "newData.isString()"
                        },
                        "createdAt": {
                            ".validate": "newData.isString()"
                        },
                        "description": {
                            ".validate": "newData.isString()"
                        }
                    }
                },
                "pointsByOrder": {
                    "$orderId": {
                        ".validate": "newData.hasChildren(['points', 'status'])"
                    }
                },
                "addresses": {
                    "$addressId": {
                        "name": {
                            ".validate": "newData.isString() && newData.val().length <= 100"
                        },
                        "phone": {
                            ".validate": "newData.isString() && newData.val().length <= 20"
                        },
                        "street": {
                            ".validate": "newData.isString() && newData.val().length <= 200"
                        },
                        "city": {
                            ".validate": "newData.isString() && newData.val().length <= 100"
                        },
                        "zip": {
                            ".validate": "newData.isString() && newData.val().length <= 10"
                        },
                        "province": {
                            ".validate": "newData.isString() && newData.val().length <= 100"
                        },
                        "instagram": {
                            ".validate": "newData.isString() && newData.val().length <= 100"
                        }
                    }
                },
                "lastAddressEditDate": {
                    ".validate": "newData.isString()"
                }
            }
        },
        "ordersByUser": {
            ".read": "auth.token.admin === true",
            "$uid": {
                ".read": "$uid === auth.uid || auth.token.admin === true",
                ".write": "$uid === auth.uid || auth.token.admin === true",
                "$orderId": {
                    "items": {
                        ".validate": "newData.exists()"
                    },
                    "total": {
                        ".validate": "newData.isNumber() && newData.val() >= 0"
                    },
                    "status": {
                        ".validate": "newData.isString() && (newData.val() === 'pendiente' || newData.val() === 'procesando' || newData.val() === 'enviado' || newData.val() === 'entregado' || newData.val() === 'cancelado' || newData.val() === 'imagenes_cliente' || newData.val() === 'confirmado')"
                    },
                    "addressEditCount": {
                        ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 1"
                    },
                    "addressEditedAt": {
                        ".validate": "newData.isString()"
                    }
                }
            }
        },
        "bestSellers": {
            ".read": true,
            ".write": "auth.token.admin === true"
        },
        "products": {
            ".read": true,
            ".write": "auth.token.admin === true"
        },
        "promoCodes": {
            ".read": "auth.token.admin === true",
            ".write": "auth.token.admin === true",
            "$codeId": {
                ".read": "auth != null",
                ".validate": "newData.hasChildren(['code', 'type', 'value', 'active'])",
                "code": {
                    ".validate": "newData.isString() && newData.val().length >= 3 && newData.val().length <= 30"
                },
                "type": {
                    ".validate": "newData.isString() && (newData.val() === 'percentage' || newData.val() === 'fixed' || newData.val() === 'free_shipping')"
                },
                "value": {
                    ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100"
                },
                "active": {
                    ".validate": "newData.isBoolean()"
                },
                "usageCount": {
                    ".write": "auth != null",
                    ".validate": "newData.isNumber() && newData.val() >= 0"
                },
                "maxUses": {
                    ".validate": "newData.isNumber() || newData.val() === null"
                },
                "createdAt": {
                    ".validate": "newData.isString()"
                },
                "createdBy": {
                    ".validate": "newData.isString()"
                }
            }
        },
        "$other": {
            ".read": false,
            ".write": false
        }
    }
}